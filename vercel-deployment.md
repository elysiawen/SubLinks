# Vercel 部署问题排查

## 订阅重建功能在 Vercel 上的限制

### 问题原因
Vercel Serverless 函数有执行时间限制：
- **Hobby 计划**：最大 10 秒
- **Pro 计划**：最大 60 秒（可配置到 300 秒）
- **Enterprise 计划**：最大 900 秒

即使使用流式响应，函数也必须在这个时间内完成。

### 解决方案

#### 1. 已添加 `maxDuration` 配置
在 `src/app/api/subscriptions/stream-rebuild/route.ts` 中添加：
```typescript
export const maxDuration = 300; // 5 分钟
```

#### 2. 建议的使用方式

**对于 Hobby 计划用户**：
- 使用批量处理模式（每批 5-10 个）
- 避免一次性重建大量订阅
- 如果订阅数超过 20 个，建议分批手动重建

**对于 Pro 计划用户**：
- 可以使用全并发模式
- 最多可处理约 100-200 个订阅（取决于每个订阅的处理时间）

#### 3. 替代方案

如果订阅数量很大，可以考虑：
1. 使用 Vercel Cron Jobs 定期重建
2. 在本地运行重建脚本
3. 使用后台任务队列（需要额外服务）

### 测试建议
1. 在 Vercel 上测试时，先用少量订阅（5-10个）
2. 观察执行时间
3. 根据实际情况调整批次大小
